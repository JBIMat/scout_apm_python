language: python
matrix:
  include:
    - python: 3.4
    - python: 3.5
    - python: 3.6
    - python: 3.7
      dist: xenial
      sudo: true
    - python: "pypy3"

cache: pip

before_install:
  - python --version
  - uname -a
  - lsb_release -a

before_install:
    - "export PYTHONPATH=$PYTHONPATH:$(pwd)"

install:
  - pip install tox
  - pip install tox-travis
  - virtualenv --version
  - easy_install --version
  - pip --version
  - tox --version

script:
  - tox -v --workdir=/tmp/tox
  - python setup.py bdist_wheel
  - if [ "${TRAVIS_PYTHON_VERSION:-}" == "3.6" ]; then
      python setup.py sdist;
    fi

after_failure:
  - more .tox/log/* | cat
  - more .tox/*/log/* | cat

notifications:
  email:
    on_success: never
    on_failure: always

deploy:
  provider: pypi
  user: scout
  distributions: sdist bdist_wheel
  password:
    secure: kXTiWUnj7TQzUiYr2CRu8OJgv8l0F7b5FbS8ZIIMd3lTLHOiMw6s+2GwTMJ7sUsd/WvaiZ1QGYXprUrASsDbUX9B/OFr2oXVblWvyABI4eaIxYtfmgoxKIFEgnfJrYGvzLQY5RNSTgeW+351bNGDStxG7OlWmqA9OUsKZIFVfOqQtVDvjIKiUxLqxqdS0qiQMN/dc6fAuWcIYWyIXx3u42JZABSWvxM7z+fSo2q9IVzSXLEirklfhCEJhzfbyTiPzQeCrenXsUWqcus1UT0FWhBEvxK+OV7hohWjt0J+OtNBc/qDiS5IOVv8ZLD5AthI4aReGUfzloxQvOfikMlEpu1/0t9mOYeidMIDBeShtkHz+X+3sDMAJakoxX2hBsTnazCLHEedEr8gGZtLbyFen0vJKmW36tDjh7cqggsbwCtYgaEADLY1joK51z2IfK6uzRmzRUnbcuFhGmjKrfl+VDAQAGFg3vmisp4my4JfAsO2YYFbNL11yIw/jHX0QfTDhMcJb1Yq1fxplc0yVgungs3QT4SOe2R3ijTpxfmzikJFSegk2KI/0EdyDWeCK5q2CWu3dqKsVp5CPU9DddLQCpCvngfiRGpb3WhOKqWGac2NLvqoq9ScK46DmCi2al1l3ixnhepJQaMxAkvbBySRZ4wXjoG26BdxuIU2eDCpVzY=
  on:
    tags: true
    repo: scoutapp/scout_apm_python
  server: https://test.pypi.org
