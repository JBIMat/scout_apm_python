language: python
matrix:
  include:
    - python: 3.4
    - python: 3.5
    - python: 3.6
    - python: 3.7
      dist: xenial
      sudo: true
    - python: "pypy3"

cache: pip

before_install:
  - python --version
  - uname -a
  - lsb_release -a

before_install:
    - "export PYTHONPATH=$PYTHONPATH:$(pwd)"

install:
  - pip install tox
  - pip install tox-travis
  - virtualenv --version
  - easy_install --version
  - pip --version
  - tox --version

script:
  - tox -v --workdir=/tmp/tox
  - python setup.py bdist_wheel
  - if [ "${TRAVIS_PYTHON_VERSION:-}" == "3.6" ]; then
      python setup.py sdist;
    fi

after_failure:
  - more .tox/log/* | cat
  - more .tox/*/log/* | cat

notifications:
  email:
    on_success: never
    on_failure: always

deploy:
  provider: pypi
  user: scout
  distributions: sdist bdist_wheel
  password:
    secure: UFfXLAxqBtCaze92ZS31n1YJsHb6ig6z5s2Ql/Uv+H8lufaz8P343xDpFdbmBQSl8udJfSOgn47+LIuC3md6DU8WH+V44nNyxn3r0nx2hU/+8/CoAj/W24OFB5S+6u8Imem3z6bK2NCGxU4OJ4Pa9LZ2i/CH+9K9Lf0VJz5VnAyJ5HmQ73XuQl57HIA/Z4BlUnEJTClKBChxEs6mLQHZeiSOzq/Py+FNqw5YGLNrtLmp/FDYs3enHhYs+0jiyC2dHgQrUKgn6CSEbcmoHce9WCMYIeKGwTKe0g0i5os1qlpFjD6D5eG4mnsZ3m/eKsI15Wg9kT+dzEo8yaB9MROGIlfLuZUOFC4+H2c7xWl+vmBTDk4EWCS6mnxFVheTHb3R+LJI4o6Edaj6MMFaxFZMHTUJ6B+7XjI1x7R0VwpBVCWQy+fk9miEcLeJ0p8CzQ9zEz2abhL3q/vVoz4wZFfN448lBdn12iJJ9pPEe6T5/dpD+bGprBjoS2BntBDF/eRq1zCPcrZ4nMwa4dwG8BWO9KOhyaXur7G6QkLQEJfjroKmZKf5xcz6FsvpREdM25gftpYG3mlbg5KCxDsVtc8xhaMUQOk1MHMaxjc78Tln+uWtIyE1s5Mu0o0roI2SVh86xtQ5nJOL65Aq+ZPBTSH2GBLRinW15sKiFdywO1oYMXM=
  on:
    tags: true
    repo: scoutapp/scout_apm_python
  server: https://test.pypi.org
